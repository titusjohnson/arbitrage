<div class="travel">
  <h1 class="travel__title">Travel</h1>

  <%
    # Create a hash for quick location lookup by coordinates
    locations_by_coords = @locations.index_by { |loc| [loc.x, loc.y] }
  %>

  <table class="locations-table">
    <% (0..4).each do |y| %>
      <tr>
        <% (0..5).each do |x| %>
          <% location = locations_by_coords[[x, y]] %>
          <td class="location-cell <%= 'location-cell--empty' unless location %> <%= "location-cell--distance-#{current_game.current_location.distance_to(location)}" if location %>">
            <% if location %>
              <%
                distance = current_game.current_location.distance_to(location)
                cost = distance <= 1 ? 0 : (distance - 1) * 100
                cost_label = cost == 0 ? "Free" : "$#{cost}"
                is_current_location = location.id == current_game.current_location_id
              %>
              <div class="location-card"
                   data-controller="travel-confirmation"
                   data-travel-confirmation-from-value="<%= current_game.current_location.name %>"
                   data-travel-confirmation-to-value="<%= location.name %>"
                   data-travel-confirmation-cost-value="<%= cost %>"
                   data-travel-confirmation-cost-label-value="<%= cost_label %>">
                <h2 class="location-card__name"><%= location.name %></h2>
                <% if location.description.present? %>
                  <p class="location-card__description"><%= location.description %></p>
                <% end %>
                <% if is_current_location %>
                  <%= button_tag cost_label,
                      title: "Travel. Advances Day",
                      disabled: :disabled,
                      class: "travel-button travel-button--distance-#{distance}" %>
                <% else %>
                  <%= button_to cost_label, travel_path,
                      params: { location_id: location.id },
                      method: :post,
                      title: "Travel. Advances Day",
                      class: "travel-button travel-button--distance-#{distance}",
                      data: {
                        distance: distance,
                        action: "click->travel-confirmation#confirm"
                      } %>
                <% end %>
              </div>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </table>
</div>
