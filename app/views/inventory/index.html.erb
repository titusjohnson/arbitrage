<div class="Page">
  <div class="Page__Header">
    <h1 class="Page__Title">Inventory</h1>
    <p class="Page__Subtitle">
      Capacity: <%= @game.current_inventory_size %> / <%= @game.inventory_capacity %>
      | Total Value: $<%= number_with_delimiter(@game.inventory_value, delimiter: ',') %>
      | Items: <%= @inventory_items.count %>
    </p>
  </div>

  <div class="Page__Content">
    <% if @inventory_items.any? %>
      <table class="Table">
        <thead>
          <tr>
            <th>Resource</th>
            <th class="Table__Cell--right">Quantity</th>
            <th class="Table__Cell--right">Purchase Price</th>
            <th class="Table__Cell--right">Total Value</th>
            <th class="Table__Cell--right">Details</th>
          </tr>
        </thead>
        <tbody>
          <% @inventory_items.each do |item| %>
            <tr>
              <td>
                <strong><%= item.resource.name %></strong>
                <% if item.resource.description.present? %>
                  <br>
                  <small class="Text--muted"><%= item.resource.description %></small>
                <% end %>
              </td>
              <td class="Table__Cell--right">
                <strong><%= item.quantity %> units</strong>
                <br>
                <small class="Text--muted">
                  Size: <%= item.resource.inventory_size %> ea
                </small>
              </td>
              <td class="Table__Cell--right">
                <strong>$<%= number_with_delimiter(item.purchase_price, delimiter: ',') %></strong>
                <br>
                <small class="Text--muted">per unit</small>
              </td>
              <td class="Table__Cell--right">
                <strong>$<%= number_with_delimiter(item.total_value, delimiter: ',') %></strong>
                <br>
                <small class="Text--muted">
                  <%= item.resource.rarity.titleize %>
                </small>
              </td>
              <td class="Table__Cell--right">
                <small class="Text--muted">
                  Day <%= item.purchase_day %>
                  <% if item.purchase_location.present? %>
                    <br>
                    @ <%= item.purchase_location.name %>
                  <% end %>
                </small>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <div class="Alert Alert--info">
        <p>Your inventory is empty. Start trading to acquire resources!</p>
      </div>
    <% end %>

    <% if @buddy_holdings.any? %>
      <h2 style="margin-top: 2rem;">Held by Buddies</h2>
      <p class="Text--muted" style="margin-bottom: 1rem;">
        Total Value: $<%= number_with_delimiter(@game.total_buddy_holdings_value.round(2), delimiter: ',') %>
      </p>

      <table class="Table">
        <thead>
          <tr>
            <th>Resource</th>
            <th>Buddy</th>
            <th class="Table__Cell--right">Quantity</th>
            <th class="Table__Cell--right">Purchase Price</th>
            <th class="Table__Cell--right">Target</th>
            <th class="Table__Cell--right">Progress</th>
          </tr>
        </thead>
        <tbody>
          <% @buddy_holdings.each do |buddy| %>
            <tr>
              <td>
                <strong><%= buddy.resource.name %></strong>
              </td>
              <td>
                <%= link_to buddy.name, buddy_path(buddy) %>
                <br>
                <small class="Text--muted">@ <%= buddy.location.name %></small>
              </td>
              <td class="Table__Cell--right">
                <strong><%= buddy.quantity %> units</strong>
              </td>
              <td class="Table__Cell--right">
                <strong>$<%= number_with_delimiter(buddy.purchase_price.round(2), delimiter: ',') %></strong>
                <br>
                <small class="Text--muted">
                  Total: $<%= number_with_delimiter(buddy.held_value.round(2), delimiter: ',') %>
                </small>
              </td>
              <td class="Table__Cell--right">
                +<%= buddy.target_profit_percent %>%
                <br>
                <small class="Text--muted">
                  $<%= number_with_delimiter(buddy.target_price.round(2), delimiter: ',') %>
                </small>
              </td>
              <td class="Table__Cell--right">
                <span class="<%= buddy.current_gain_percent >= 0 ? 'Text--success' : 'Text--danger' %>">
                  <%= buddy.current_gain_percent >= 0 ? '+' : '' %><%= buddy.current_gain_percent %>%
                </span>
                <br>
                <small class="Text--muted">
                  <%= buddy.progress_percent %>% to target
                </small>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  </div>
</div>
