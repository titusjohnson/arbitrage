<div class="Page">
  <div class="Page__Header">
    <h1 class="Page__Title">Inventory</h1>
    <p class="Page__Subtitle">
      Capacity: <%= @game.current_inventory_size %> / <%= @game.inventory_capacity %>
      | Total Value: $<%= number_with_delimiter(@game.inventory_value, delimiter: ',') %>
      | Items: <%= @inventory_items.count %>
    </p>
  </div>

  <div class="Page__Content">
    <% if @inventory_items.any? %>
      <div class="inventory-list">
        <% @inventory_items.each do |item| %>
          <div class="inventory-card">
            <div class="inventory-card__header">
              <h3 class="inventory-card__name"><%= item.resource.name %></h3>
              <div class="inventory-card__meta">
                <span class="Text--muted">Size: <%= item.resource.inventory_size %></span>
                <span class="Text--muted"><%= item.resource.rarity.titleize %></span>
              </div>
            </div>

            <% if item.resource.description.present? %>
              <p class="inventory-card__description"><%= item.resource.description %></p>
            <% end %>

            <div class="inventory-card__body">
              <div class="inventory-card__purchase">
                <div class="inventory-card__price">
                  <strong>$<%= number_with_delimiter(item.purchase_price, delimiter: ',') %></strong>
                  <span class="Text--muted">per unit</span>
                </div>
                <div class="inventory-card__details">
                  <span class="Text--muted">Day <%= item.purchase_day %></span>
                  <% if item.purchase_location.present? %>
                    <span class="Text--muted">@ <%= item.purchase_location.name %></span>
                  <% end %>
                </div>
              </div>

              <div class="inventory-card__position">
                <span class="inventory-card__qty"><%= item.quantity %> units</span>
                <span class="inventory-card__value">$<%= number_with_delimiter(item.total_value, delimiter: ',') %></span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="Alert Alert--info">
        <p>Your inventory is empty. Start trading to acquire resources!</p>
      </div>
    <% end %>

    <% if @buddy_holdings.any? %>
      <h2 style="margin-top: 2rem;">Held by Buddies</h2>
      <p class="Text--muted" style="margin-bottom: 1rem;">
        Total Value: $<%= number_with_delimiter(@game.total_buddy_holdings_value.round(2), delimiter: ',') %>
      </p>

      <div class="inventory-list">
        <% @buddy_holdings.each do |buddy| %>
          <div class="inventory-card inventory-card--buddy">
            <div class="inventory-card__header">
              <h3 class="inventory-card__name"><%= buddy.resource.name %></h3>
              <div class="inventory-card__meta">
                <span><%= link_to buddy.name, buddy_path(buddy) %></span>
                <span class="Text--muted">@ <%= buddy.location.name %></span>
              </div>
            </div>

            <div class="inventory-card__body">
              <div class="inventory-card__purchase">
                <div class="inventory-card__price">
                  <strong>$<%= number_with_delimiter(buddy.purchase_price.round(2), delimiter: ',') %></strong>
                  <span class="Text--muted">per unit</span>
                </div>
                <div class="inventory-card__target">
                  <span>Target: +<%= buddy.target_profit_percent %>%</span>
                  <span class="Text--muted">$<%= number_with_delimiter(buddy.target_price.round(2), delimiter: ',') %></span>
                </div>
              </div>

              <div class="inventory-card__position">
                <span class="inventory-card__qty"><%= buddy.quantity %> units</span>
                <span class="inventory-card__value">$<%= number_with_delimiter(buddy.held_value.round(2), delimiter: ',') %></span>
                <span class="<%= buddy.current_gain_percent >= 0 ? 'Text--success' : 'Text--danger' %>">
                  <%= buddy.current_gain_percent >= 0 ? '+' : '' %><%= buddy.current_gain_percent %>%
                </span>
                <span class="Text--muted"><%= buddy.progress_percent %>% to target</span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
